---
title: "Isoprostanos en función de TBI"
author: Lora Obed , Rubio Ángel, Salazar Marelly, Sandoval César, Vazquez Samantha,
  Vilchis Hazel
output: html_notebook
---


```{r setup, include=FALSE}
library(patchwork)
library(NeurocienciasIntroData)
library(tidyverse)
library(dplyr)
library(pwr)
library(ggplot2)
library(MASS)
library(effsize)
library(survival)
library(patch)
library(fitdistrplus)
library(effsize)
```

## **Data set a utilizar**
### **Donor.information**
```{r echo=FALSE}
donor.information_<-donor.information
head(donor.information_)

```
### **protein.pathology**
```{r echo=FALSE}
protein.pathology_<-protein.pathology
head(protein.pathology_)

```

## **Datos, orden y limpieza de los datos**

```{r include=FALSE}

protein.pathology_<-protein.pathology_%>%
  dplyr::select(donor_id, isoprostane_pg_per_mg, structure_acronym)
donor.information_<-donor.information_%>%
  dplyr::select(donor_id, age, age_at_first_tbi,
                dsm_iv_clinical_diagnosis,longest_loc_duration,
                num_tbi_w_loc, ever_tbi_w_loc,sex,education_years)

id_protein.p<-donor.information_ %>% full_join(protein.pathology_,by =c("donor_id"))
names(id_protein.p)



tbi_y <- data.frame(filter(id_protein.p, age_at_first_tbi > 0 & 
                             isoprostane_pg_per_mg > 0))
tbi_n <- data.frame (filter(id_protein.p, age_at_first_tbi == 0 &
                              isoprostane_pg_per_mg > 0))

```
### **Datos con TBI**
```{r echo=FALSE}
head(tbi_y)

```
### **Datos sin TBI**
```{r echo=FALSE}
head(tbi_n)

```


## **Data set de la Corteza Temporal**
```{r echo=FALSE}
TCx_tbi_y<-tbi_y%>%
  filter(structure_acronym == "TCx")
TCx_tbi_n<-tbi_n%>%
  filter(structure_acronym == "TCx")

TCx<-data.frame (filter(id_protein.p, isoprostane_pg_per_mg > 0 & structure_acronym == "TCx"))

```

#### **Corteza temporal con TBI**
```{r echo=FALSE}
head(TCx_tbi_y) 
```
#### **Corteza temporal sin TBI**
```{r echo=FALSE}
head(TCx_tbi_n) 
```



#### **Tamaño de a muestra con TBI**
```{r echo=FALSE}
nrow(TCx_tbi_n)

```
#### **sin TBI**
```{r echo=FALSE}
nrow(TCx_tbi_y)

```

## Gráficas para representar a los grupos

### **Patologías en el grupo con tbi**
```{r echo=FALSE}

ggplot(TCx_tbi_y, aes(x=factor(dsm_iv_clinical_diagnosis)))+
  geom_bar(stat="count", width=0.7, fill="steelblue")+
  theme_bw() + labs(title = "Patologías en el grupo con tbi", x = "Diagnóstico clínico", y = "Cantidad de sujetos") + scale_y_continuous(breaks=seq(0,12, by = 2)) + theme(axis.text.x = element_text(size=7)) + geom_text(stat='count', aes(label=..count..), vjust=-1) + coord_cartesian(ylim=c(0,13))
```

### ** Patologías sin TBI**
```{r echo=FALSE}
ggplot(TCx_tbi_n, aes(x=factor(dsm_iv_clinical_diagnosis)))+
  geom_bar(stat="count", width=0.7, fill="steelblue")+
  theme_bw()+ labs(title = "Patologías en el grupo sin tbi", x = "Diagnóstico clínico", y = "Cantidad de sujetos")+ scale_y_continuous(breaks=seq(0,20, by = 2))+
  geom_text(stat='count', aes(label=..count..), vjust=-1) + coord_cartesian(ylim=c(0,20))
```


```{r echo=FALSE}
id_protein.p %>%
  filter(structure_acronym == "TCx", isoprostane_pg_per_mg > 0) %>%
  ggplot(aes(x=factor(dsm_iv_clinical_diagnosis), fill = age_at_first_tbi>0)) + geom_bar(stat = "count", position = "dodge") + theme_minimal()+
  labs(title = "Patologías en ambos grupos", x = "Diagnóstico clínico", y = "Cantidad de sujetos") +
  scale_y_continuous(breaks=seq(0,20, by = 2))  + coord_cartesian(ylim=c(0,20)) + theme(axis.text.x = element_text(size=6.3)) +
  
```
### **Gráfica de la concentración de isoprostanos recpecto a TCE**
```{r}
ggplot(TCx, aes(x = ever_tbi_w_loc == "Y", y = isoprostane_pg_per_mg, color = ever_tbi_w_loc == "Y")) + geom_boxplot(show.legend = FALSE) + labs(x = NULL, y = "Concentración de isoprostanos") + scale_x_discrete(labels = c("Sin TCE", "Con TCE")) + 
  theme_minimal()
```


## **Cantidad de sujetos minimo para el estudio**
```{r echo=FALSE}
pwr.t.test(n = NULL, 
           d = 0.8, 
           sig.level = 0.05, 
           type = "two.sample", 
           alternative = "greater", 
           power = 0.8)
?pwr.t.test
```

## **Sujetos**

- Con la prueba t.test anterior see requiren 20 sujetos. 

- Hay 32 individuos sin TBI y 30 individuos con TBI, ambos grupos con mediciones
de isoprostane en corteza temporal.



## **Hacemos la estadística descriptiva de la muestra**

### **Media, mediana y desviación estandar**
```{r  echo=FALSE}
estaDescr<-function(x){
  c(media=mean(x,na.rm = TRUE), 
    mediana=median(x,na.rm = TRUE),
    desviacion_e=sd(x,na.rm = TRUE))}

TCx_tbi_y_<-TCx_tbi_y%>%
  dplyr::select(num_tbi_w_loc,isoprostane_pg_per_mg,age_at_first_tbi)
TCx_tbi_n_<-TCx_tbi_n%>%
  dplyr::select(isoprostane_pg_per_mg) 
  
lapply(TCx_tbi_y_, estaDescr)
lapply(TCx_tbi_n_, estaDescr)

```
### **Intervalos de confianza**

```{r include=FALSE}
intervalo95<-function(x,y,z){
  a<- (y+(1.96*(x/sqrt(z))))
  print("intervalo superior")
  print(a)
  b<-(y-(1.96*(x/sqrt(z))))
  print("Intervalo inferior")
  print(b)
  }
```
#### **Intervalos para el grupo con TBI**
```{r echo=FALSE}
intervalo95(x=1.31849, y=3.037520, z=66)
```
#### **Intervalos para el grupo sn TBI**

```{r echo=FALSE}
intervalo95(x=1.262854, y=2.968923, z=66)
```

##### **Revisar si nuestros datos siguen una distribución normal**    
```{r  echo=FALSE}
shapiro.test(TCx_tbi_y$isoprostane_pg_per_mg)
shapiro.test(TCx_tbi_n$isoprostane_pg_per_mg)
```
Al salir como resultado menos a 0.05 entonces decimos que la muestra proviene de una distribución normal; se acepta la hipotesis nula (H0).


### **Otra para determinar si nuestros datos siguen normalidad**

```{r echo=FALSE}
qqnorm(TCx_tbi_y$isoprostane_pg_per_mg, frame=FALSE, 
       main= "Distribución de los datos en el grupo con TCE",
       xlab="grupo con TCE")
qqline(TCx_tbi_y$isoprostane_pg_per_mg,col="red", lw=2)
qqnorm(TCx_tbi_n$isoprostane_pg_per_mg, frame=FALSE, 
       main= "Distribución de los datos en el grupo sin TCE",
       xlab="grupo sin TCE")
qqline(TCx_tbi_n$isoprostane_pg_per_mg,col="red", lw=2)
```



## **Distribución**

En vista de que los datos no siguen una distribución normal (pero si provienen de una), lo siguente es encontrar cual es la distribución más próxima de nuestro grupo de interés. 

```{r echo=FALSE}
descdist(TCx_tbi_y$isoprostane_pg_per_mg, boot=100)
```
Podemos afirmar entonces que la distribución que siguen los datos es una distribución de tipo B. Como se puede ver en los puntos amarillos y  multiples repeticiones (100) tiende a ser una distribución normal.


## **Prueba parametrica**

### **tamaño del efecto**


```{r}
cohen.d(isoprostane_pg_per_mg~ever_tbi_w_loc, data=TCx, paired=FALSE)
```


```{r echo=FALSE}
bartlett.test(list(TCx_tbi_y$isoprostane_pg_per_mg, TCx_tbi_n$isoprostane_pg_per_mg))
```

```{r echo=FALSE}
t.test(TCx_tbi_y$isoprostane_pg_per_mg,TCx_tbi_n$isoprostane_pg_per_mg)

```


## **Gráficos de los resultados**

```{r echo=FALSE}

number_TBI<-as.factor(TCx_tbi_y$num_tbi_w_loc)
categoricaNumber<-as.character(number_TBI)
TCx_tbi_y$num_tbi_w_loc<-categoricaNumber

q<-ggplot(TCx_tbi_y, aes(y=isoprostane_pg_per_mg, x=num_tbi_w_loc,
                         xlab= "número de TBI", ylab="Concentración de Isoprostanos"))+
                          geom_boxplot(color="black", fill="steelblue")+
                          ggtitle("Isoprostanos en función de TBI's")

q+ labs(x="Número de TBI", y="Concentración de Isoprostanos")+theme_minimal()

```


## **Gráficos sin presencia de TBI**


```{r echo=FALSE}

number_TBI<-as.factor(TCx_tbi_n$num_tbi_w_loc)
categoricaNumber<-as.character(number_TBI)
TCx_tbi_n$num_tbi_w_loc<-categoricaNumber

m<-ggplot(TCx_tbi_n, aes(y=isoprostane_pg_per_mg, x=(num_tbi_w_loc), fill=dsm_iv_clinical_diagnosis, xlab= "número de TBI", ylab="cocnentración de Isoprostanos"))+
  geom_boxplot()+
  scale_fill_discrete(name = "Tipo de demencia" , labels = c("Alzherimar", "Multiples Etiologías", "Sin demencia", "Otros transtornos", "desconocidos", "vascular"))
  ggtitle("Isoprostanos en función de no TCE")

m+ labs(x="", y="Concentración de Isoprostanos")+theme_minimal()

```

Gráficas adicionales para la discusión

```{r}
ggplot(TCx_tbi_y, aes(y=age, fill=factor(dsm_iv_clinical_diagnosis)))+
  geom_bar()+
  facet_grid(TCx_tbi_y$sex ~. )+
  labs(
    title="Edades de los sujetos respecto a TCE y sexo",
    y= "Edad e los individuos",
    x="Cantidad de sujetos")+
  scale_fill_discrete(name = "Tipo de demencia" , labels = c("Alzherimar", "Multiples Etiologías", "Sin demencia", "Otros transtornos", "desconocidos", "vascular"))
```



```{r fig.height=5}
 ggplot(TCx_tbi_y, aes(y=age, fill=factor(dsm_iv_clinical_diagnosis)))+
  geom_bar()+
  facet_grid(.~ TCx_tbi_y$num_tbi_w_loc)+
   labs(
    title = "Cantidad y edad de  los sujetos respecto a demencias por el número de TCE",
    x= "Cantidad de sujetos",
    y=" Edades")+
    scale_fill_discrete(name = NULL, labels = c("Alzherimar", "Multiples Etiologías", "Sin demencia", "Otros transtornos", "Desconocidas", "Vascular"))+

```



